import{S as q,p as B,r as d,s as T,a as y,n as M,i as Q,b as H,t as ee,c as j,f as te,d as se,e as W,g as J,h as f,k as K,u as re,l as X,R as O,m as ne,o as ie,q as ae,j as r,v as oe,w as ce,x as he,L as le}from"./main-tizexeE-.js";var ue=class extends q{constructor(e,t){super(),this.options=t,this.#s=e,this.#n=null,this.#r=B(),this.bindMethods(),this.setOptions(t)}#s;#e=void 0;#p=void 0;#t=void 0;#a;#l;#r;#n;#m;#u;#d;#o;#c;#i;#f=new Set;bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(this.#e.addObserver(this),z(this.#e,this.options)?this.#h():this.updateResult(),this.#v())}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return _(this.#e,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return _(this.#e,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,this.#y(),this.#R(),this.#e.removeObserver(this)}setOptions(e){const t=this.options,s=this.#e;if(this.options=this.#s.defaultQueryOptions(e),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof d(this.options.enabled,this.#e)!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");this.#S(),this.#e.setOptions(this.options),t._defaulted&&!T(this.options,t)&&this.#s.getQueryCache().notify({type:"observerOptionsUpdated",query:this.#e,observer:this});const n=this.hasListeners();n&&V(this.#e,s,this.options,t)&&this.#h(),this.updateResult(),n&&(this.#e!==s||d(this.options.enabled,this.#e)!==d(t.enabled,this.#e)||y(this.options.staleTime,this.#e)!==y(t.staleTime,this.#e))&&this.#x();const i=this.#b();n&&(this.#e!==s||d(this.options.enabled,this.#e)!==d(t.enabled,this.#e)||i!==this.#i)&&this.#g(i)}getOptimisticResult(e){const t=this.#s.getQueryCache().build(this.#s,e),s=this.createResult(t,e);return fe(this,s)&&(this.#t=s,this.#l=this.options,this.#a=this.#e.state),s}getCurrentResult(){return this.#t}trackResult(e,t){return new Proxy(e,{get:(s,n)=>(this.trackProp(n),t?.(n),n==="promise"&&(this.trackProp("data"),!this.options.experimental_prefetchInRender&&this.#r.status==="pending"&&this.#r.reject(new Error("experimental_prefetchInRender feature flag is not enabled"))),Reflect.get(s,n))})}trackProp(e){this.#f.add(e)}getCurrentQuery(){return this.#e}refetch({...e}={}){return this.fetch({...e})}fetchOptimistic(e){const t=this.#s.defaultQueryOptions(e),s=this.#s.getQueryCache().build(this.#s,t);return s.fetch().then(()=>this.createResult(s,t))}fetch(e){return this.#h({...e,cancelRefetch:e.cancelRefetch??!0}).then(()=>(this.updateResult(),this.#t))}#h(e){this.#S();let t=this.#e.fetch(this.options,e);return e?.throwOnError||(t=t.catch(M)),t}#x(){this.#y();const e=y(this.options.staleTime,this.#e);if(Q||this.#t.isStale||!H(e))return;const s=ee(this.#t.dataUpdatedAt,e)+1;this.#o=j.setTimeout(()=>{this.#t.isStale||this.updateResult()},s)}#b(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(this.#e):this.options.refetchInterval)??!1}#g(e){this.#R(),this.#i=e,!(Q||d(this.options.enabled,this.#e)===!1||!H(this.#i)||this.#i===0)&&(this.#c=j.setInterval(()=>{(this.options.refetchIntervalInBackground||te.isFocused())&&this.#h()},this.#i))}#v(){this.#x(),this.#g(this.#b())}#y(){this.#o&&(j.clearTimeout(this.#o),this.#o=void 0)}#R(){this.#c&&(j.clearInterval(this.#c),this.#c=void 0)}createResult(e,t){const s=this.#e,n=this.options,i=this.#t,h=this.#a,o=this.#l,b=e!==s?e.state:this.#p,{state:l}=e;let a={...l},g=!1,c;if(t._optimisticResults){const u=this.hasListeners(),v=!u&&z(e,t),S=u&&V(e,s,t,n);(v||S)&&(a={...a,...se(l.data,e.options)}),t._optimisticResults==="isRestoring"&&(a.fetchStatus="idle")}let{error:R,errorUpdatedAt:F,status:x}=a;c=a.data;let P=!1;if(t.placeholderData!==void 0&&c===void 0&&x==="pending"){let u;i?.isPlaceholderData&&t.placeholderData===o?.placeholderData?(u=i.data,P=!0):u=typeof t.placeholderData=="function"?t.placeholderData(this.#d?.state.data,this.#d):t.placeholderData,u!==void 0&&(x="success",c=W(i?.data,u,t),g=!0)}if(t.select&&c!==void 0&&!P)if(i&&c===h?.data&&t.select===this.#m)c=this.#u;else try{this.#m=t.select,c=t.select(c),c=W(i?.data,c,t),this.#u=c,this.#n=null}catch(u){this.#n=u}this.#n&&(R=this.#n,c=this.#u,F=Date.now(),x="error");const k=a.fetchStatus==="fetching",I=x==="pending",N=x==="error",D=I&&k,L=c!==void 0,m={status:x,fetchStatus:a.fetchStatus,isPending:I,isSuccess:x==="success",isError:N,isInitialLoading:D,isLoading:D,data:c,dataUpdatedAt:a.dataUpdatedAt,error:R,errorUpdatedAt:F,failureCount:a.fetchFailureCount,failureReason:a.fetchFailureReason,errorUpdateCount:a.errorUpdateCount,isFetched:a.dataUpdateCount>0||a.errorUpdateCount>0,isFetchedAfterMount:a.dataUpdateCount>b.dataUpdateCount||a.errorUpdateCount>b.errorUpdateCount,isFetching:k,isRefetching:k&&!I,isLoadingError:N&&!L,isPaused:a.fetchStatus==="paused",isPlaceholderData:g,isRefetchError:N&&L,isStale:U(e,t),refetch:this.refetch,promise:this.#r,isEnabled:d(t.enabled,e)!==!1};if(this.options.experimental_prefetchInRender){const u=m.data!==void 0,v=m.status==="error"&&!u,S=w=>{v?w.reject(m.error):u&&w.resolve(m.data)},A=()=>{const w=this.#r=m.promise=B();S(w)},C=this.#r;switch(C.status){case"pending":e.queryHash===s.queryHash&&S(C);break;case"fulfilled":(v||m.data!==C.value)&&A();break;case"rejected":(!v||m.error!==C.reason)&&A();break}}return m}updateResult(){const e=this.#t,t=this.createResult(this.#e,this.options);if(this.#a=this.#e.state,this.#l=this.options,this.#a.data!==void 0&&(this.#d=this.#e),T(t,e))return;this.#t=t;const s=()=>{if(!e)return!0;const{notifyOnChangeProps:n}=this.options,i=typeof n=="function"?n():n;if(i==="all"||!i&&!this.#f.size)return!0;const h=new Set(i??this.#f);return this.options.throwOnError&&h.add("error"),Object.keys(this.#t).some(o=>{const p=o;return this.#t[p]!==e[p]&&h.has(p)})};this.#C({listeners:s()})}#S(){const e=this.#s.getQueryCache().build(this.#s,this.options);if(e===this.#e)return;const t=this.#e;this.#e=e,this.#p=e.state,this.hasListeners()&&(t?.removeObserver(this),e.addObserver(this))}onQueryUpdate(){this.updateResult(),this.hasListeners()&&this.#v()}#C(e){J.batch(()=>{e.listeners&&this.listeners.forEach(t=>{t(this.#t)}),this.#s.getQueryCache().notify({query:this.#e,type:"observerResultsUpdated"})})}};function de(e,t){return d(t.enabled,e)!==!1&&e.state.data===void 0&&!(e.state.status==="error"&&t.retryOnMount===!1)}function z(e,t){return de(e,t)||e.state.data!==void 0&&_(e,t,t.refetchOnMount)}function _(e,t,s){if(d(t.enabled,e)!==!1&&y(t.staleTime,e)!=="static"){const n=typeof s=="function"?s(e):s;return n==="always"||n!==!1&&U(e,t)}return!1}function V(e,t,s,n){return(e!==t||d(n.enabled,e)===!1)&&(!s.suspense||e.state.status!=="error")&&U(e,s)}function U(e,t){return d(t.enabled,e)!==!1&&e.isStaleByTime(y(t.staleTime,e))}function fe(e,t){return!T(e.getCurrentResult(),t)}var Y=f.createContext(!1),pe=()=>f.useContext(Y);Y.Provider;function me(){let e=!1;return{clearReset:()=>{e=!1},reset:()=>{e=!0},isReset:()=>e}}var xe=f.createContext(me()),be=()=>f.useContext(xe),ge=(e,t,s)=>{const n=s?.state.error&&typeof e.throwOnError=="function"?K(e.throwOnError,[s.state.error,s]):e.throwOnError;(e.suspense||e.experimental_prefetchInRender||n)&&(t.isReset()||(e.retryOnMount=!1))},ve=e=>{f.useEffect(()=>{e.clearReset()},[e])},ye=({result:e,errorResetBoundary:t,throwOnError:s,query:n,suspense:i})=>e.isError&&!t.isReset()&&!e.isFetching&&n&&(i&&e.data===void 0||K(s,[e.error,n])),Re=(e,t)=>t.state.data===void 0,Se=e=>{if(e.suspense){const s=i=>i==="static"?i:Math.max(i??1e3,1e3),n=e.staleTime;e.staleTime=typeof n=="function"?(...i)=>s(n(...i)):s(n),typeof e.gcTime=="number"&&(e.gcTime=Math.max(e.gcTime,1e3))}},Ce=(e,t)=>e.isLoading&&e.isFetching&&!t,we=(e,t)=>e?.suspense&&t.isPending,$=(e,t,s)=>t.fetchOptimistic(e).catch(()=>{s.clearReset()});function je(e,t,s){const n=pe(),i=be(),h=re(),o=h.defaultQueryOptions(e);h.getDefaultOptions().queries?._experimental_beforeQuery?.(o);const p=h.getQueryCache().get(o.queryHash);o._optimisticResults=n?"isRestoring":"optimistic",Se(o),ge(o,i,p),ve(i);const b=!h.getQueryCache().get(o.queryHash),[l]=f.useState(()=>new t(h,o)),a=l.getOptimisticResult(o),g=!n&&e.subscribed!==!1;if(f.useSyncExternalStore(f.useCallback(c=>{const R=g?l.subscribe(J.batchCalls(c)):M;return l.updateResult(),R},[l,g]),()=>l.getCurrentResult(),()=>l.getCurrentResult()),f.useEffect(()=>{l.setOptions(o)},[o,l]),we(o,a))throw $(o,l,i);if(ye({result:a,errorResetBoundary:i,throwOnError:o.throwOnError,query:p,suspense:o.suspense}))throw a.error;return h.getDefaultOptions().queries?._experimental_afterQuery?.(o,a),o.experimental_prefetchInRender&&!Q&&Ce(a,n)&&(b?$(o,l,i):p?.promise)?.catch(M).finally(()=>{l.updateResult()}),o.notifyOnChangeProps?a:l.trackResult(a)}function Ee(e,t){return je({...e,enabled:!0,suspense:!0,throwOnError:Re,placeholderData:void 0},ue)}function Oe({children:e}){const{isLoading:t,isAuthenticated:s}=X();return t||!s?null:O.createElement(O.Fragment,null,e)}function ke({children:e}){const{isLoading:t,isAuthenticated:s}=X();return t||s?null:O.createElement(O.Fragment,null,e)}function Z(e,t){const s={get(n,i){if(typeof i=="string"){const h=[...t,i];return Z(e,h)}else if(i===ne){if(t.length<1){const h=[e,...t].join(".");throw new Error(`API path is expected to be of the form \`${e}.childComponent.functionName\`. Found: \`${h}\``)}return"_reference/childComponent/"+t.join("/")}else return}};return new Proxy({},s)}const Ie=()=>Z("components",[]),G=ie;Ie();function Fe(){const{user:e,signInUrl:t,signUpUrl:s}=ae.useLoaderData();return r.jsx(Ne,{user:e,signInUrl:t,signUpUrl:s})}function Ne({user:e,signInUrl:t,signUpUrl:s}){return r.jsxs(r.Fragment,{children:[r.jsxs("header",{className:"sticky top-0 z-10 bg-background p-4 border-b-2 border-slate-200 dark:border-slate-800 flex flex-row justify-between items-center",children:["Convex + TanStack Start + WorkOS",e&&r.jsx(Qe,{user:e})]}),r.jsxs("main",{className:"p-8 flex flex-col gap-8",children:[r.jsx("h1",{className:"text-4xl font-bold text-center",children:"Convex + TanStack Start + WorkOS"}),r.jsx(Oe,{children:r.jsx(Me,{})}),r.jsx(ke,{children:r.jsx(Te,{signInUrl:t,signUpUrl:s})})]})]})}function Te({signInUrl:e,signUpUrl:t}){return r.jsxs("div",{className:"flex flex-col gap-8 w-96 mx-auto",children:[r.jsx("p",{children:"Log in to see the numbers"}),r.jsx("a",{href:e,children:r.jsx("button",{className:"bg-foreground text-background px-4 py-2 rounded-md",children:"Sign in"})}),r.jsx("a",{href:t,children:r.jsx("button",{className:"bg-foreground text-background px-4 py-2 rounded-md",children:"Sign up"})})]})}function Me(){const{data:{viewer:e,numbers:t}}=Ee(ce(G.myFunctions.listNumbers,{count:10})),s=he(G.myFunctions.addNumber);return r.jsxs("div",{className:"flex flex-col gap-8 max-w-lg mx-auto",children:[r.jsxs("p",{children:["Welcome ",e,"!"]}),r.jsx("p",{children:"Click the button below and open this page in another window - this data is persisted in the Convex cloud database!"}),r.jsx("p",{children:r.jsx("button",{className:"bg-foreground text-background text-sm px-4 py-2 rounded-md",onClick:()=>{s({value:Math.floor(Math.random()*10)})},children:"Add a random number"})}),r.jsxs("p",{children:["Numbers: ",t.length===0?"Click the button!":t.join(", ")]}),r.jsxs("p",{children:["Edit"," ",r.jsx("code",{className:"text-sm font-bold font-mono bg-slate-200 dark:bg-slate-800 px-1 py-0.5 rounded-md",children:"convex/myFunctions.ts"})," ","to change your backend"]}),r.jsxs("p",{children:["Edit"," ",r.jsx("code",{className:"text-sm font-bold font-mono bg-slate-200 dark:bg-slate-800 px-1 py-0.5 rounded-md",children:"src/routes/index.tsx"})," ","to change your frontend"]}),r.jsxs("p",{children:["See"," ",r.jsx(le,{to:"/authenticated",className:"underline hover:no-underline",children:"/authenticated"})," ","for an example of a page only available to authenticated users."]}),r.jsxs("div",{className:"flex flex-col",children:[r.jsx("p",{className:"text-lg font-bold",children:"Useful resources:"}),r.jsxs("div",{className:"flex gap-2",children:[r.jsxs("div",{className:"flex flex-col gap-2 w-1/2",children:[r.jsx(E,{title:"Convex docs",description:"Read comprehensive documentation for all Convex features.",href:"https://docs.convex.dev/home"}),r.jsx(E,{title:"Stack articles",description:"Learn about best practices, use cases, and more from a growing collection of articles, videos, and walkthroughs.",href:"https://stack.convex.dev"})]}),r.jsxs("div",{className:"flex flex-col gap-2 w-1/2",children:[r.jsx(E,{title:"Templates",description:"Browse our collection of templates to get started quickly.",href:"https://www.convex.dev/templates"}),r.jsx(E,{title:"Discord",description:"Join our developer community to ask questions, trade tips & tricks, and show off your projects.",href:"https://www.convex.dev/community"})]})]})]})]})}function E({title:e,description:t,href:s}){return r.jsxs("div",{className:"flex flex-col gap-2 bg-slate-200 dark:bg-slate-800 p-4 rounded-md h-28 overflow-auto",children:[r.jsx("a",{href:s,className:"text-sm underline hover:no-underline",children:e}),r.jsx("p",{className:"text-xs",children:t})]})}function Qe({user:e}){const{signOut:t}=oe();return r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"text-sm",children:e.email}),r.jsx("button",{onClick:()=>t(),className:"bg-red-500 text-white px-3 py-1 rounded-md text-sm hover:bg-red-600 cursor-pointer",children:"Sign out"})]})}export{Fe as component};
